## 高吞吐

- 顺序写入磁盘
- 零拷贝：内存和磁盘之间拷贝次数减少sendfile（）。系统调用直接将文件从磁盘传输到网络缓冲区，无需将数据加载到用户态内存。
- 批量处理：批量发送/接收
- 分区并行：Topic 被划分为多个partition分区，每个分区可以独立读写，分布在不同的 Broker 上。



## 消息顺序

- 生产者：
  - 单线程生产者分区策略
  - 同一个key的消息按消息顺序写入同一个分区
- broker：
  - 顺序写日志文件
  - leader负责写入、follower仅仅同步（避免多点写入带来的乱序）
- 消费者：
  - 单线程消费
  - 消费者会维持偏移量，可以避免重复消费/失败消费带来的乱序问题

## 消息不丢

- 生产者

  - ack机制：等待leader的ack

  - 失败时自动重试
  - 启用幂等性：保证重试不会导致消息重复

- broker：

  - 消息持久化：写入磁盘
  - leader会有follower
  - 使用同步副本集合确保 Leader 宕机时消息仍可从 Follower 恢复。

- 消费者
  - 手动提交offset：消费者在确定消息被正确消费才会提交